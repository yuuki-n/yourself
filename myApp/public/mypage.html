<!DOCTYPE html>
<html lang="jp">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link rel="stylesheet" href="post0111.css"> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://kit.fontawesome.com/af750d91d7.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="mypage.css">

    <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/6.2.0/firebase-firestore.js"></script>
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    <script src="./config.js"></script>
    <script>

        // cloudfirestoreの場所を定義する処理
        var db = firebase.firestore().collection('post')
        // var db = firebase.firestore();


        // // サインインしていなかったら、indexに飛ばす
        firebase.auth().onAuthStateChanged((user) => {
            if (!user) {
                location.href = '/index.html';
            } else {
                // サインイン済み
            }
        });


        // // サインインしていなかったら、indexに飛ばす
        // var user = firebase.auth().currentUser;

    </script>

</head>

<body>

    <div class="content">
        <header>
            <p>マイページ</p>
        </header>

        <main>
            <div id="thumbnail" class="thumbnail">
                <div>
                    <div id="output" class="output"></div>
        </main>

        <footer>
            <hr>
            <!-- 投稿 -->
            <button type="button" id="postpage">
                <i class="fas fa-plus-square"></i>
            </button>

            <!-- マイページ -->
            <button type="button" id="mypage">
                <i class="fas fa-user-circle"></i>
            </button>
        </footer>

    </div>


    <script>
        //  < !--  データをリアルタイムに取得する処理 'time'新しい順 desc:降順 -->
        // $('#output').css('border-radius', '50%');

        $(function () {
            db.orderBy('created_at', 'desc').onSnapshot(function (querySnapshot) {
                let str = '';
                querySnapshot.forEach(function (doc) {
                    // console.log(doc.id);
                    // console.log(doc.data());
                    str += '<div id="' + doc.id + '">';
                    str += '<img class="photo" src="' + doc.data().img_url + '"></img>' + doc.data().product_name;
                    // str += '<p>' + doc.data().product_name + '</p>';
                    str += '<p>' + doc.data().category + '</p>';
                    str += '<p>' + doc.data().time + '</p>';
                    str += '<p>' + doc.data().change + '</p>';
                    str += '</div>';
                    str += '<hr>';
                });
                $('#output').html(str);

            });
        });


        // 投稿ページに遷移
        $('#postpage').on('click', function () {
            location.href = '/post.html';
        });

        // マイページに遷移
        $('#mypage').on('click', function () {
            location.href = '/toppage.html';
        });


    </script>

</body>

</html>