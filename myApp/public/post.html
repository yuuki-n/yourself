<!DOCTYPE html>
<html lang="jp">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <link rel="stylesheet" href="post.css">

    <script src="https://kit.fontawesome.com/af750d91d7.js" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/7.7.0/firebase.js"></script>
    <script src="https://cdn.firebase.com/libs/firebaseui/3.5.2/firebaseui.js"></script>
    <script src="https://www.gstatic.com/firebasejs/5.8.1/firebase-auth.js"></script>
    <script src="./config.js"></script>


    <script>

        // cloudfirestoreの場所を定義する処理
        var db = firebase.firestore().collection('post')

        firebase.auth().onAuthStateChanged((user) => {
            console.log(user);

            //------------------------------------
            // 未ログイン状態で訪れた場合
            //------------------------------------
            if (user === null) {
                showMessage('Not Login', 'ログインが必要な画面です');
                return (false);
            }
        });


    </script>

</head>

<body>
    <div class="content">
        <div class="wrap_box">

            <div class="menu">
                <i class="fas fa-angle-left fa-2x"></i>
                <a href="#" id="send" class="word_btn">送信</a>
                <!-- <button class="submit">送信</button> -->
            </div>

            <main>

                <div id="img_url" class="preview"></div>
                <!-- <img id="preview"> -->

                <!-- <form action="upload.php" method="post" enctype="multipart/form-data"> -->
                <form>
                    <label for="image_url">
                        <i class="fas fa-camera"></i>
                        <input type="file" name="upfile" id="image_url" style="display:none;" accept="image/*"
                            capture="camera">
                    </label>
                    <!-- <img src="IMG_1117.PNG" alt="買ったものの画像" class="thumbnail"> -->
                    <input type="text" id="product_name" class="caption" placeholder="キャプションを書く"></input>
                </form>

                <div>

                    <p>カテゴリを選択</p>
                    <button class="button1" name="button1" id="electronics" value="">家電</button>
                    <button class="button1" id="beauty" value="">美容</button>
                    <button class="button1" id="fashion" value="ファッション">ファッション</button>
                    <!-- <hr class="category-endline"> -->



                    <p>時間を選択</p>
                    <button class="button2" id="morning" value="">朝</button>
                    <button class="button2" id="daytime" value="">昼</button>
                    <button class="button2" id="night" value="">夜</button>
                    <!-- <hr class="timezone-endline"> -->

                    <p>変化を選択</p>
                    <button class="button3" id="change1" value="時短になった">時短になった</button>
                    <button class="button3" id="change2" value="楽しくなった">楽しくなった</button>
                    <button class="button3" id="change3" value="規則正しくなった">規則正しくなった</button>
                    <button class="button3" id="change4" value="社交的になった">社交的になった</button>


                </div>
                <hr>
            </main>
        </div>
    </div>

</body>

</html>

<script>

    // 画像をプレビューする
    // $('#image_url').on('change', function (e) {
    //     var reader = new FileReader();
    //     reader.onload = function (e) {
    //         $("#preview").attr('src', e.target.result);
    //     }
    //     reader.readAsDataURL(e.target.files[0]);
    // });
    let imageUrl = '';
    // 選択した画像を表示する
    $(function () {
        //画像ファイルプレビュー表示のイベント追加 fileを選択時に発火するイベントを登録
        $('form').on('change', 'input[type="file"]', function (e) {
            var file = e.target.files[0],
                reader = new FileReader(),
                $preview = $(".preview");
            t = this;

            // 画像ファイル以外の場合は何もしない
            // if (file.type.indexOf("image") < 0) {
            //     return false;
            // }



            // ファイル読み込みが完了した際のイベント登録
            reader.onload = (function (file) {
                return function (e) {
                    //既存のプレビューを削除
                    $preview.empty();
                    // .prevewの領域の中にロードした画像を表示するimageタグを追加
                    // console.log(e.target.result)


                    imageUrl = e.target.result;
                    $preview.append($('<img>').attr({
                        src: e.target.result,
                        // width: "15%",
                        // height: "15%",
                        width: "150px",
                        height: "150px",
                        class: "preview",
                        title: file.name
                    }));
                };
            })(file);

            reader.readAsDataURL(file);
        });
    });






    // $(function () {
    //     $('.button1').on('click', function () {
    //         var category = $(this).attr("value");
    //     });
    // });

    // 家電を選んだ時に、美容とファッションを表示しない方を初期化
    // $(function () {
    //     $('#electorics').on('click', function () {
    //         $("#beauty").text("");
    //         $("#fashion").text("");
    //     });
    // });

    // value 値を取得して表示
    // $("#out2").text($("#rd2").val());
    // var category = $('.button1').val();

    // $(function () {
    //     $('#beauty').on('click', function () {
    //         $("#electorics").text("");
    //         $("#fashion").text("");
    //     });
    // });


    // 家電ボタンを押したとき
    $(function () {
        $("#electronics").on("click", function () {
            // value 値を設定
            $('.button1').val('家電');
        });
    });

    // 美容ボタンを押したとき
    $(function () {
        $("#beauty").on("click", function () {
            // value 値を設定
            $('.button1').val('美容');
        });
    });

    // ファッションボタンを押したとき
    $(function () {
        $("#fashion").on("click", function () {
            // value 値を設定
            $('.button1').val('ファッション');
        });
    });

    // 朝ボタンを押したとき
    $(function () {
        $("#morning").on("click", function () {
            // value 値を設定
            $('.button2').val('朝');
        });
    });

    // 昼ボタンを押したとき
    $(function () {
        $("#daytime").on("click", function () {
            // value 値を設定
            $('.button2').val('昼');
        });
    });

    // 夜ボタンを押したとき
    $(function () {
        $("#night").on("click", function () {
            // value 値を設定
            $('.button2').val('夜');
        });
    });

    // 時短になったボタンを押したとき
    $(function () {
        $("#change1").on("click", function () {
            // value 値を設定
            $('.button3').val('時短になった');
        });
    });

    // 楽しくなったボタンを押したとき
    $(function () {
        $("#change2").on("click", function () {
            // value 値を設定
            $('.button3').val('楽しくなった');
        });
    });

    // 規則正しくなったボタンを押したとき
    $(function () {
        $("#change3").on("click", function () {
            // value 値を設定
            $('.button3').val('規則正しくなった');
        });
    });

    // 社交的になったボタンを押したとき
    $(function () {
        $("#change3").on("click", function () {
            // value 値を設定
            $('.button3').val('社交的になった');
        });
    });



    // カテゴリボタンの色を変更する
    $(function () {
        $('.button1').on('click', function () {
            $('.button1').removeClass('active1');
            $(this).addClass('active1');
        });
    });

    // 時間ボタンの色を変更する
    $(function () {
        $('.button2').on('click', function () {
            $('.button2').removeClass('active2');
            $(this).addClass('active2');
        });
    });

    // 変化ボタンの色を変更する
    $(function () {
        $('.button3').on('click', function () {
            $('.button3').removeClass('active3');
            $(this).addClass('active3');
        });
    });

    // 日時を取得する関数
    function getNowDatetime() {
        const date = new Date();
        const year = date.getFullYear();
        const month = ('0' + (date.getMonth() + 1)).slice(-2);
        const day = ('0' + date.getDate()).slice(-2);
        const hour = ('0' + date.getHours()).slice(-2);
        const min = ('0' + date.getMinutes()).slice(-2);
        const sec = ('0' + date.getSeconds()).slice(-2);
        return `${year}-${month}-${day}T${hour}:${min}:${sec}`
    }


    // 送信ボタンクリックで投稿
    $('#send').on('click', function () {
        const data = {
            // img_url: $('#img_url').val(),
            img_url: imageUrl,
            product_name: $('#product_name').val(),
            created_at: getNowDatetime(),
            category: $('.button1').val(),
            time: $('.button2').val(),
            change: $('.button3').val(),

        };


        // console.log(data);

        db.add(data);
        $('#img_url').val('');
        $('#product_name').val('');
        $('#category').val('');
        $('#time').val('');
        $('#change').val('');
    });




</script>